		TITLE ZADANIE1
		INCLUDE BMACROS.INC
		INCLUDE UMACROS.INC
		INCLUDE FMACROS.INC
		INCLUDE SMAKRA.INC
		
		PUBLIC BUFFER
		EXTRN P1:FAR
		EXTRN INPUT:FAR
		EXTRN COUNT:FAR
		EXTRN SUBST:FAR
		EXTRN OCCURENCES:FAR
		
		STK SEGMENT STACK
			DW 64 DUP(?);
		STK ENDS
		DATA SEGMENT PUBLIC 'DATA'
			;BEZNE VYPISY A CHYBOVE HLASKY
			ENT DB 10, 13, '$'
			MENU1 DB 10, 13, 'A) ZADAT MENO SUBORU', 10, 13, '$'
			MENU2 DB 'B) VYPISAT OBSAH SUBORU', 10, 13, '$'
			MENU3 DB 'C) NACITAT RETAZEC A VYPISAT POCET VYSKYTOV', 10, 13, '$'
			MENU4 DB 'D) UKONCIT PROGRAM', 10, 13, '$'
			ERR1 DB 'ERROR OPENING FILE', 10,13,'$'
			ERR2 DB 'FILE READING ERROR', 10, 13, '$'
			ERR3 DB 'FILE CLOSING ERROR', 10, 13, '$'
			VYZVA DB 'ZADAJTE PODRETAZEC>', 10,13,'$'
			OZNAM DB 'VYPISUJEM SUBOR>', 10,13,'$'
			;DATOVA STRUKTURA PRE ULOZENIE VSTUPU NAZVU RETAZCA
			INP DB 100 
			POCET DB 0;REALNY POCET ZNAKOV V RETAZCI
				  DB 103 DUP(0);BUFFER VELKOSTI 100
			;DATA KDE JE ZALOZNY RETAZEC
			FNAME DB 103 DUP(0);
			;FILE HANDLE TEMPORARY STORAGE
			HANDLE DW ?  ;POZN. AX JE 16 BITOV
			;BUFFER PRE DATA ZO SUBORU
			BUFFER DB 200 DUP(0)
			;ULOZISKO PRE POZICIU KURZORA
			CURSROW DB 0	;NA ZACIATKU ZACINA NA 0
			CURSCOL DB 0	;NA ZAC NA 0
			;CAS A DATUM
			HOURS DB ?
			MINS DB ?
			SECONDS DB ?
			DAY DB ?
			MONTH DB ?
			YEAR DW ?
		DATA ENDS
		
		CODE SEGMENT PUBLIC 'CODE'
			ASSUME CS:CODE, DS:DATA, SS:STK
			;LOKALNE PROCEDURY ZATIAL TU
			FILENAME PROC
					SETFNAME
					CLEAR
					MOVESTART ;REALIZUJ PRESUN KURZORA NA PRVU MOZNU POZICIU
					BACKUPSTRING
					;print nazov suboru
					LEA DX, POCET[1]
					MOV AH, 09H
					INT 21H
					RET
					;TMP SHOULD BE UNREACHABLE OTHER THAN AL, 44H
			FILENAME ENDP
			READFILE PROC
				PRINT OZNAM
				FOPEN
				FREAD
				FCLOSE
				KEYWAIT
				CLEAR
				MOVESTART
				RET
			READFILE ENDP
			SUBRETAZEC PROC
				SETSTRING
				FOPEN
				SEARCH
				FCLOSE
				RET
			SUBRETAZEC ENDP
			START:
					MOV AX, SEG DATA
					MOV DS, AX
					CLEAR
					MOVESTART
			MAINLOOP:
					TIMEDATE
					MENU MENU1, MENU2, MENU3, MENU4
					USERINPUT	;BUDE BUFFROVAT DO CL
					PRINTENTER
					MOV AL, CL
					CMP AL, 41H
						JZ MENO
					CMP AL, 42H
						JZ FPRINT
					CMP AL, 43H
						JZ SU
					CMP AL, 44H
						JZ TMP
						JNE EL0
			MENO:
				CALL FILENAME
				JMP MAINLOOP
			FPRINT:
				CALL READFILE
				JMP MAINLOOP
				TMP: JMP KONIEC
				EL0: JMP EL
			SU:
				PRINT VYZVA
				SETSTRING
				FOPEN
				SEARCH
				FCLOSE
				MOV SI, OFFSET OCCURENCES
				PRINTENTER
				CONVERTTONUM [SI]
				MOV DX, 0H
				MOV [SI], DX
				KEYWAIT
				CLEAR
				MOVESTART
				JMP MAINLOOP
			EL:		;NASTANE AK INY VSTUP
					CLEAR;POZOR AK SA TOTO VOLA PRED PUTCHAR TAK SA PREMAZE VSTUP V REGISTROCH
					MOVESTART 
					XOR AX, AX
					JMP MAINLOOP ;ZACAT OD ZACIATKU, TOTO TRVA DOKIAL NEZADA 'D'
			KONIEC:
					MOV AX, 4C00H;UKONCI PROGRAM
					INT 21H
		CODE ENDS
		END START
