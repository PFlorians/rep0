;;;;;;;;;;;;;;;;;;;;;;
;MACROS FOR FILE WORK;
;;;;;;;;;;;;;;;;;;;;;;

;;;;;;;;;;;;;;;;;;;;;;
;       FILENAME     ;
;;;;;;;;;;;;;;;;;;;;;;
	SETFNAME MACRO
		LOCAL L1, NEW
			MOV DX, OFFSET INP;+1B = POCET
			MOV SI, DX
	
		L1:	
			INC SI	;AK UZ SU TAM DATA TAK TREBA VYNULOVAT VSETKO CO TAM JE INAK NASTANE PROBLEM
			MOV BL, [SI]
			CMP BL, 0;DEFAULTNE BY TO MALO BYT VSETKO NULA
				JE NEW
			MOV BL, 0
			MOV [SI], BL
			JMP L1
		NEW:
			MOV AH, 0AH		;NACITANIE RETAZCA A PRIDANIE DOLARA PRE DEBUG, MENO SA DA HNED VYTLACIT
			INT 21H
			;start debug tmp 
			MOV SI, OFFSET POCET
			XOR DX, DX
			XOR AX, AX
			MOV DX, OFFSET POCET
			MOV AL, BYTE PTR[SI]
			ADD DX, AX
			MOV BX, DX
			MOV BYTE PTR[BX]+2, '$';toto je len na vypis
			;end debug tmp here
		ENDM
		
		;;;;;;;;;;;;;;;;;;;;;;
		; OPEN FILE, HANDLE  ;
		; IN DATA SEGMENT    ;
		;;;;;;;;;;;;;;;;;;;;;;
		FOPEN MACRO
		LOCAL ER1, KONCI
			MOV AX, 3D00H
			;MOV AL, 02H ;OTVORIT AKO R/W MOD
			LEA DX, FNAME ;MENO SUBORU
			INT 21H
			JC ER1
			JMP KONCI
		ER1:
			PRINT ERR1
		KONCI:
			MOV HANDLE, AX;ULOZIT AX DO HANDLE
		ENDM
		
		;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
		;CLOSE FILE SAVE DESCRIPTORS ;
		;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
		FCLOSE MACRO
		LOCAL ER3, KONCI1
			MOV BX, HANDLE
			MOV AH, 3EH
			INT 21H
			JC ER3
			JMP KONCI1
			PRINTENTER
		ER3:
			PRINT ERR3
		KONCI1:
		ENDM
		FREAD MACRO
		LOCAL READ, ER2, CLOSE
		READ:
			MOV BX, HANDLE
			MOV CX, 190	;CITAJ SUBOR 
			LEA DX, BUFFER
			MOV AH, 3FH
			INT 21H
			JC ER2
			CMP AX, 0
				JZ CLOSE
			
			PRINTUNTILZERO BUFFER
			CLEARBUFFER BUFFER
			JMP READ
		ER2:
			PRINT ERR2
		CLOSE:
		ENDM
		;;;;;;;;;;;;;;;;;;;;;;;;;;
		; TO ISTE AKO FREAD      ;
		; LEN VOLA EXTERNU       ;
		; PROCEDURU              ;
		;;;;;;;;;;;;;;;;;;;;;;;;;;
		SEARCH MACRO
		LOCAL SEAR, CLOS, VOLANIE, ER2
		SEAR:
			MOV BX, HANDLE
			MOV CX, 190	;CITAJ SUBOR 
			LEA DX, BUFFER
			MOV AH, 3FH
			INT 21H
			JC ER2
			CMP AX, 0
				JZ CLOS
			JMP VOLANIE
		ER2:
			PRINT ERR2
		VOLANIE:
			CALL P1
			JMP SEAR
		CLOS:
		ENDM
